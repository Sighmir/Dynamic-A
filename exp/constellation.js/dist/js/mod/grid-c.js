define(["lib/underscore","lib/backbone","lib/constellation","./grid-m","./selection-m"],function(e,t,n,r,i){var s=t.Model.extend({nodeOpsEnabled:function(){return i.type==="n"},newGrid:function(){i.deselectAll(!0),r.reset()},saveGrid:function(){r.save()},print:function(){typeof console!="undefined"&&console.log?(console.log(JSON.stringify(r.toJSON())),this.alert("Grid data printed to your console")):this.alert("No console available")},joinNodes:function(){this.nodeOpsEnabled()&&i.selectionSize()>1?r.joinNodes(i.items):this.alert("Select two or more nodes",i.selectionSize())},splitNodes:function(){this.nodeOpsEnabled()&&i.selectionSize()>1?r.splitNodes(i.items):this.alert("Select two or more joined nodes",i.selectionSize())},makePolygon:function(){this.nodeOpsEnabled()&&i.selectionSize()>=3?r.addPolygon(i.items):this.alert("Select three or more nodes",i.selectionSize())},deleteGeometry:function(){if(!i.selectionSize()){this.alert("No selected geometry");return}this.nodeOpsEnabled()?r.removeNodes(i.items):r.removePolygons(i.items),i.deselectAll()},findPath:function(){if(this.nodeOpsEnabled()&&i.selectionSize()===2){var t=r.findPath(i.items[0],i.items[1]);t.valid?(i.selectPath(e.pluck(t.nodes,"id")),this.alert("Shortest route of "+Math.round(t.weight)+"px")):this.alert("No valid routes")}else this.alert("Select two nodes",i.selectionSize())},snapNodeToGrid:function(){if(this.nodeOpsEnabled()&&i.selectionSize()===1){var t=r.getNodeById(i.items[0]),n=r.snapPoint(t);e.size(t.to)?this.alert("Node must be unconnected"):(t.x=n.x,t.y=n.y,r.update())}else this.alert("Select a single node")},selectNearestGridNode:function(){if(this.nodeOpsEnabled()&&i.selectionSize()===1){var e=r.getNearestNodeToNode(i.items[0]);i.select(e.id)}else this.alert("Select a single node")},hitTestGeometry:function(){if(i.selectionSize()===1){var e;if(this.nodeOpsEnabled()){var t=r.getNodeById(i.items[0]);e=r.getPolygonHitsForPoint(t)}else e=r.getNodesInPolygon(i.items[0]);e&&e.length?i.setSelection(e):this.alert("No intersections")}else this.alert("Select a single node or polygon")},alert:function(e,t){this.trigger("alert",e,t)}});return new s});